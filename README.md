## Qutils
Утилиты для предобработки текстовых файлов (.csv, .txt) архивными данными котировок в формате терминала QUIK.

## Краткое описание

Содержит два питоновских скртпта `cleaner.py` для первичной проверки/очистки данных и `merger.py` для склеивания/объединения двух файлов с котировками в один файл.    
Если склеиваемые файлы содержат данные за одни и те же даты (например, фьючерсы разных серий), автоматически выбирается инструмент с большим дневным объемом.    
Сначала файл орабатывается `cleaner.py`, затем, при необходимости, обработанные файлы склеиваются `merger.py`


### `cleaner.py`

- преобразует названия колонок к нормальному виду: чистит `<>` и приводит к нижнему регистру, например `<TICKER>` -> `ticker`
    -- проверяет, что период (таймфрема) всех баров уникален
- вычищает лишнее (*SPBFUT*, *SPFB*) из названия тикера
- **создает нормальный столбец `datetime`** с временем в формате ISO
- удалаяет исходные столбцы `date`, `time` *(опционально, можно их оставить)*
- **удаляет данные по утренней/вечерней сессиям** *(опционально, можно оставить)*
- удаляет дубликаты, сортирует данные по времени
- обрезает данные по заданному интервалу дат *(до даты Х и/или от даты Y, опционально)*
- **проверяет внутридневные данные на наличие пропусков данных/ошибок времени баров**

### `merger.py`

- проверяет, что склеиваемые файлы имеют одинаковую структуру
- **объединяет (склеивает) два файла, которые могут содержать данные за одни и те же дни**, в этом случае автоматически выбирается инструмент с большим дневным объемом.
- обрезает итоговые по заданному интервалу дат *(до даты Х и/или от даты Y, опционально)*
- для объединенных данных выводит названия тикеров по дням *(опционально)*  


## Установка

Необходим свежий python и единственный дполнительный модуль pandas.  

Клонируем репозиторий и переходим в директорию проекта
`````````
git clone https://github.com/AV31459/Qutils.git
cd Qutils
`````````
Создаем и активируем виртуальное окружение, устанавливаем зависимости:
`````````
python -m venv venv
source venv/Scripts/activate
pip install -r requirements.txt
`````````
ну или просто скачать себе два файла (cleaner.py/merger.py) и обновить pandas (*для тех, кто понимает, что он делает :)*)
`````````
pip install pandas -U
`````````

## Запуск `cleaner.py`

Из командной строки в диреткории проекта
`````````
python cleaner.py исходный_файл [опции]
`````````

Опции:

`-h`, `--help` : выводит описание и список возможных опций     

`-d <имя_файла>` или `--dest-file <имя_файла>` : имя файла для сохранения обработанных данных   

`-c` или `--check-only` : только проверка, не сохранять обработанные данные в файл  

`-s` или `--stock` : отсутствие дневного клиринга 14:00-14:05 (для акций)

`-e` или `--extended-hours` : не удалять данные утренней/вечерней сесии  

`-k` или `--keep-date-time` : не удалять столбцы `date` и `time`

`--start-date ГГГГ-ММ-ДД` : удалить (обрезать) данные до указанной даты

`--end-date ГГГГ-ММ-ДД` : удалить (обрезать) данные после указанной даты

`-i` или `--interactive` : выводить подтверждающие запросы во время выполенния

## Запуск `merger.py`

Из командной строки в диреткории проекта
`````````
python merger.py файл_1 файл_2 (-d итогоывый файл или -с) [опции]
`````````
Опции:

`-h`, `--help` : выводит описание и список возможных опций     

`-d <имя_файла>` или `--dest-file <имя_файла>` : имя файла для сохранения обработанных данных   

`-c` или `--check-only` : только проверка, не сохранять обработанные данные в файл  

`--start-date ГГГГ-ММ-ДД` : удалить (обрезать) данные до указанной даты

`--end-date ГГГГ-ММ-ДД` : удалить (обрезать) данные после указанной даты

`-i` или `--interactive` : выводить подтверждающие запросы во время выполенния
